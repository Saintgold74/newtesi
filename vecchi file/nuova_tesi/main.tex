\documentclass[12pt,a4paper,oneside]{book}

% ===== XELATEX: FONT ARIAL WINDOWS =====
\usepackage{fontspec}

% Windows 11: Arial è in C:\Windows\Fonts\
\setmainfont{Arial}[
    BoldFont = {Arial Bold},
    ItalicFont = {Arial Italic},
    BoldItalicFont = {Arial Bold Italic}
]

% In caso di problemi, path esplicito Windows:
% \setmainfont{C:/Windows/Fonts/arial.ttf}[
%     BoldFont = {C:/Windows/Fonts/arialbd.ttf},
%     ItalicFont = {C:/Windows/Fonts/ariali.ttf},
%     BoldItalicFont = {C:/Windows/Fonts/arialbi.ttf}
% ]

% ===== LINGUA ITALIANA =====
\usepackage{polyglossia}
\setdefaultlanguage{italian}

% ===== MARGINI ESATTI COME DA REGOLAMENTO =====
\usepackage[
    top=3.5cm,
    bottom=3.5cm,
    left=4.5cm,
    right=3cm,
    headheight=15pt
]{geometry}

% ===== INTERLINEA 1.5 =====
\usepackage{setspace}
\onehalfspacing

% ===== RIENTRO PRIMA RIGA =====
\setlength{\parindent}{1.25cm}

% ===== GESTIONE BIBLIOGRAFIA MODULARE =====
\usepackage{bibunits}
\usepackage{cite}

% ===== NOTE A PIÈ DI PAGINA =====
\usepackage[bottom,hang]{footmisc}
\usepackage{chngcntr}

% Reset numerazione note per ogni capitolo
\counterwithin{footnote}{chapter}

% Formattazione note secondo regolamento
\renewcommand{\footnotelayout}{%
    \setlength{\parindent}{0.6cm}%
    \fontsize{10}{12}\selectfont%
}

% Parentesi tonde per i numeri delle note
\renewcommand{\thefootnote}{(\arabic{footnote})}
\renewcommand{\footnoterule}{%
    \kern -3pt
    \hrule width \textwidth height 0.4pt
    \kern 2pt
}

% ===== PACCHETTI UTILI =====
\usepackage{lipsum} % Per testo segnaposto
\usepackage{fancyvrb}
\usepackage{graphicx}
\usepackage{caption}
\usepackage{subcaption}
\usepackage{amsmath,amssymb}
\usepackage{algorithm}
\usepackage{algorithmicx}
\usepackage{algpseudocode}
\usepackage{amsfonts}
\usepackage{listings}
\usepackage{xcolor}
\usepackage{url}
\usepackage{fancyhdr}
\usepackage{array}
\usepackage{longtable}
\usepackage{booktabs}
\usepackage{multirow}
\usepackage{csquotes}
\usepackage{standalone}
\usepackage[most]{tcolorbox} % Add this line to the preamble of your main.tex file
\usepackage{stackengine}

\usepackage[toc,nopostdot,nonumberlist]{glossaries}
\makeglossaries

\usepackage{tikz}
\usepackage{pgfplots}
\pgfplotsset{compat=1.17}
\usetikzlibrary{shapes,arrows,positioning,calc,patterns,decorations.pathreplacing,shadows}
\usetikzlibrary{shapes.geometric,shapes.symbols,shapes.misc}
\usetikzlibrary{matrix,chains,scopes,fit,backgrounds}
\usetikzlibrary{arrows.meta, positioning, shapes, calc}

\graphicspath{{figure/}}
% Imposta la profondità di numerazione fino a subsection (livello 2)
\setcounter{secnumdepth}{3}
% Imposta la profondità del TOC (Table of Contents) per includere le subsubsection
\setcounter{tocdepth}{3}

% ===== MAIUSCOLETTO =====
\usepackage{textcase}
\newcommand{\autore}[1]{\textsc{#1}}

% ===== CONFIGURAZIONE TITOLI CAPITOLI E SEZIONI =====
\usepackage{titlesec}

% Formato capitoli
\titleformat{\chapter}[display]
{\normalfont\fontsize{14}{16}\selectfont\bfseries}
{\MakeUppercase{\chaptertitlename}\ \thechapter}
{20pt}
{\fontsize{14}{16}\selectfont\bfseries\MakeUppercase}

% Formato sezioni (11pt, grassetto come da regolamento)
\titleformat{\section}
{\normalfont\fontsize{11}{13}\selectfont\bfseries}
{\thesection}
{1em}
{}

\titleformat{\subsection}
{\normalfont\fontsize{11}{13}\selectfont\bfseries}
{\thesubsection}
{1em}
{}

\titleformat{\subsubsection}
{\normalfont\fontsize{11}{13}\selectfont\bfseries}
{\thesubsubsection}
{1em}
{}

% Spaziatura titoli
\titlespacing*{\chapter}{0pt}{-20pt}{30pt}
\titlespacing*{\section}{0pt}{12pt}{6pt}
\titlespacing*{\subsection}{0pt}{12pt}{6pt}

% ===== NUMERAZIONE PAGINE =====
\pagestyle{fancy}
\fancyhf{}
\fancyfoot[C]{\thepage}
\renewcommand{\headrulewidth}{0pt}
\renewcommand{\footrulewidth}{0pt}

\fancypagestyle{plain}{
    \fancyhf{}
    \fancyfoot[C]{\thepage}
    \renewcommand{\headrulewidth}{0pt}
    \renewcommand{\footrulewidth}{0pt}
}

% ===== CONFIGURAZIONE LISTINGS PER CODICE =====
\definecolor{codegreen}{rgb}{0,0.6,0}
\definecolor{codegray}{rgb}{0.5,0.5,0.5}
\definecolor{codepurple}{rgb}{0.58,0,0.82}
\definecolor{backcolour}{rgb}{0.95,0.95,0.92}

\lstdefinestyle{mystyle}{
    backgroundcolor=\color{backcolour},
    commentstyle=\color{codegreen}\fontsize{10}{12}\selectfont,
    keywordstyle=\color{magenta}\fontsize{10}{12}\selectfont,
    numberstyle=\tiny\color{codegray},
    stringstyle=\color{codepurple}\fontsize{10}{12}\selectfont,
    basicstyle=\ttfamily\fontsize{10}{12}\selectfont,
    breakatwhitespace=false,
    breaklines=true,
    captionpos=b,
    keepspaces=true,
    numbers=left,
    numbersep=5pt,
    showspaces=false,
    showstringspaces=false,
    showtabs=false,
    tabsize=2
}
\lstset{style=mystyle}

% ===== CONFIGURAZIONE BIBLIOGRAFIA =====
\defaultbibliography{bibliografia/generale}
\defaultbibliographystyle{plain}

% ===== INDICE GENERALE - Formattazione =====
\usepackage{tocloft}
\renewcommand{\cftdot}{.}
\renewcommand{\cftchapleader}{\cftdotfill{\cftdotsep}}
\renewcommand{\cftsecleader}{\cftdotfill{\cftdotsep}}
\renewcommand{\cftchapfont}{\normalfont}
\renewcommand{\cftchappagefont}{\normalfont}
\setlength{\cftchapnumwidth}{2em}

% ===== HYPERREF (sempre ultimo) =====
\usepackage[
    colorlinks=false,
    pdfborder={0 0 0},
    bookmarks=true,
    bookmarksopen=true,
    unicode=true
]{hyperref}

% ===== INIZIO DOCUMENTO =====
\begin{document}

% Frontespizio (senza numerazione)
\pagenumbering{gobble}
\input{frontespizio}
\clearpage

% Prefazione (numerazione romana)
\pagenumbering{roman}
\input{prefazione}
\clearpage

% Indice generale
\tableofcontents
\clearpage

% Indice delle figure (se presente)
\listoffigures
\clearpage

% Indice delle tabelle (se presente)
\listoftables
\clearpage

% Capitoli (numerazione araba)
\pagenumbering{arabic}
\include{capitoli/new1}
\include{capitoli/new2}
\include{capitoli/new3}
\include{capitoli/new4-2}
\include{capitoli/new5}
\include{capitoli/new_app}

% Bibliografia generale finale (opzionale)
\bibliographystyle{plain}
\bibliography{bibliografia/generale}

\end{document}